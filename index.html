<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥åº—äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- LIFF SDKã‚’èª­ã¿è¾¼ã¿ã¾ã™ -->
    <script src="https://static.line-scdn.net/liff/2.22.3/liff.js"></script>

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: #f7f9fb;
            color: #1f2937;
            margin: 0;
            padding: 0;
        }

        .mobile-container {
            max-width: 450px;
            min-height: 100vh;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 100%;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            margin: 0 auto;
        }

        .step-section {
            background-color: #ffffff;
            border-radius: 1.25rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .step-section.active {
            border: 2px solid #ec4899;
            /* pink-500 */
            background-color: #fff1f2;
            /* pink-50 */
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãƒ»ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .custom-radio:checked+div {
            border-color: #ec4899;
            background-color: #fdf2f8;
            color: #be185d;
        }

        .custom-radio:checked+div .check-icon {
            opacity: 1;
        }

        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .calendar-day:hover:not(.disabled) {
            background-color: #fce7f3;
        }

        .calendar-day.selected {
            background-color: #ec4899 !important;
            color: white !important;
        }

        .calendar-day.disabled {
            color: #d1d5db;
            cursor: not-allowed;
            background-color: transparent;
        }

        .calendar-day.today {
            font-weight: bold;
            border: 1px solid #ec4899;
        }

        /* æ™‚é–“é¸æŠãƒœã‚¿ãƒ³ */
        .time-slot {
            transition: all 0.2s;
        }

        .time-slot:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .time-slot.selected {
            background-color: #ec4899;
            color: white;
            border-color: #ec4899;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* èª­ã¿è¾¼ã¿ä¸­ã‚¹ãƒ”ãƒŠãƒ¼ */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #ec4899;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite;
            /* Safari */
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        .step-dot {
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background-color: #ec4899;
            transform: scale(1.2);
        }

        .step-dot.completed {
            background-color: #ec4899;
        }

    </style>
</head>

<body>
    <div class="mobile-container relative">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="bg-pink-500 text-white p-4 shadow-md sticky top-0 z-50">
            <h1 class="text-lg font-bold text-center flex items-center justify-center gap-2">
                <span>âœ¨</span> æ¥åº—äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ 
            </h1>
            <!-- é€²æ—ãƒãƒ¼ -->
            <div class="mt-4 px-2">
                <div class="flex justify-between text-xs font-medium mb-1 opacity-90">
                    <span id="step-status">Step 1/6</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="w-full bg-pink-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-white h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 15%"></div>
                </div>
                <!-- ã‚¹ãƒ†ãƒƒãƒ—ãƒ‰ãƒƒãƒˆ -->
                <div class="flex justify-between mt-2 px-1" id="step-dots-container">
                    <!-- JSã§ç”Ÿæˆ -->
                </div>
            </div>
        </header>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="flex-1 p-4 pb-24 overflow-y-auto bg-gray-50" id="main-content">
            <form id="booking-form" onsubmit="return false;">

                <!-- ã‚¨ãƒ©ãƒ¼/æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="message-area" class="mb-4 hidden p-3 rounded-lg text-sm text-center font-medium shadow-sm"></div>

                <!-- STEP 1: ã”äºˆç´„å†…å®¹ -->
                <div id="step-1" class="step-section fade-in">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">1</span>
                        ã”äºˆç´„å†…å®¹
                    </h2>
                    <div class="space-y-3">
                        <label class="cursor-pointer block relative">
                            <input type="radio" name="menu" value="æŒ¯è¢–ï¼ˆã”è³¼å…¥ï¼‰" class="custom-radio sr-only" onchange="handleMenuChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <span class="font-medium">æŒ¯è¢–ï¼ˆã”è³¼å…¥ï¼‰</span>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="menu" value="æŒ¯è¢–ï¼ˆãƒ¬ãƒ³ã‚¿ãƒ«ï¼‰" class="custom-radio sr-only" onchange="handleMenuChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <span class="font-medium">æŒ¯è¢–ï¼ˆãƒ¬ãƒ³ã‚¿ãƒ«ï¼‰</span>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="menu" value="æŒ¯è¢–ï¼ˆãƒãƒæŒ¯è¢–ï¼‰" class="custom-radio sr-only" onchange="handleMenuChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <span class="font-medium">æŒ¯è¢–ï¼ˆãƒãƒæŒ¯è¢–ï¼‰</span>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="menu" value="å’æ¥­è¢´ï¼ˆãƒ¬ãƒ³ã‚¿ãƒ«/æŒ¯è¢–è³¼å…¥è€…ï¼‰" class="custom-radio sr-only" onchange="handleMenuChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <span class="font-medium">å’æ¥­è¢´ï¼ˆãƒ¬ãƒ³ã‚¿ãƒ«/æŒ¯è¢–è³¼å…¥è€…ï¼‰</span>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="menu" value="å’æ¥­è¢´ï¼ˆä¸€å¼ãƒ¬ãƒ³ã‚¿ãƒ«/æŒ¯è¢–ãƒ¬ãƒ³ã‚¿ãƒ«è€…ï¼‰" class="custom-radio sr-only" onchange="handleMenuChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <span class="font-medium text-sm">å’æ¥­è¢´ï¼ˆä¸€å¼ãƒ¬ãƒ³ã‚¿ãƒ«/æŒ¯è¢–ãƒ¬ãƒ³ã‚¿ãƒ«è€…ï¼‰</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- STEP E Redirect: é›»è©±äºˆç´„èª˜å°ç”»é¢ (æœ€åˆã¯éè¡¨ç¤º) -->
                <div id="step-E-redirect" class="step-section hidden fade-in text-center py-10">
                    <div class="mb-6 text-pink-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold mb-4 text-gray-800">ãŠé›»è©±ã§ã®ã”äºˆç´„ã‚’ãŠé¡˜ã„ã—ã¾ã™</h3>
                    <p class="text-gray-600 mb-8 leading-relaxed">
                        ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚<br>
                        é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã€WEBäºˆç´„å¯¾è±¡å¤–ã¨ãªã‚Šã¾ã™ã€‚<br>
                        ãŠæ‰‹æ•°ã§ã™ãŒã€Studio Angeï¼ˆã‚¹ã‚¿ã‚¸ã‚ªã‚¢ãƒ³ã‚¸ãƒ¥ï¼‰ã¾ã§<br>ãŠé›»è©±ã«ã¦ã”äºˆç´„ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
                    </p>
                    <a href="tel:0123456789" class="inline-block bg-pink-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-pink-600 transition-colors transform active:scale-95">
                        ğŸ“ é›»è©±ã§äºˆç´„ã™ã‚‹
                    </a>
                    <div class="mt-6">
                        <button type="button" onclick="resetForm()" class="text-sm text-gray-400 underline">æœ€åˆã«æˆ»ã‚‹</button>
                    </div>
                </div>


                <!-- STEP 2: åº—èˆ—é¸æŠ -->
                <div id="step-2" class="step-section hidden fade-in">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">2</span>
                        åº—èˆ—ã‚’é¸æŠ
                    </h2>
                    <div class="grid grid-cols-1 gap-3">
                        <label class="cursor-pointer block relative">
                            <input type="radio" name="store" value="ã‹ã›å±‹ å’Œæ­Œå±±åº—" class="custom-radio sr-only" onchange="handleStoreChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all">
                                <div class="flex items-center mb-1">
                                    <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                        <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                    </span>
                                    <span class="font-bold">ã‹ã›å±‹ å’Œæ­Œå±±åº—</span>
                                </div>
                                <div class="text-xs text-gray-500 ml-8">å–¶æ¥­æ™‚é–“: 10:00 - 19:00</div>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="store" value="ã‹ã›å±‹ æµ·å—åº—" class="custom-radio sr-only" onchange="handleStoreChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all">
                                <div class="flex items-center mb-1">
                                    <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                        <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                    </span>
                                    <span class="font-bold">ã‹ã›å±‹ æµ·å—åº—</span>
                                </div>
                                <div class="text-xs text-gray-500 ml-8">å–¶æ¥­æ™‚é–“: 10:00 - 18:00</div>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="store" value="ã‹ã›å±‹ å²©å‡ºåº—" class="custom-radio sr-only" onchange="handleStoreChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all">
                                <div class="flex items-center mb-1">
                                    <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                        <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                    </span>
                                    <span class="font-bold">ã‹ã›å±‹ å²©å‡ºåº—</span>
                                </div>
                                <div class="text-xs text-gray-500 ml-8">å–¶æ¥­æ™‚é–“: 10:00 - 18:30</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- STEP 3: æ—¥ä»˜é¸æŠ -->
                <div id="step-3" class="step-section hidden fade-in">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">3</span>
                        æ—¥ä»˜ã‚’é¸æŠ
                    </h2>

                    <div class="bg-white rounded-xl border border-gray-200 p-4">
                        <div class="flex justify-between items-center mb-4">
                            <button type="button" onclick="changeMonth(-1)" class="p-2 text-gray-600 hover:bg-gray-100 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <span id="calendar-title" class="font-bold text-lg">2024å¹´ 11æœˆ</span>
                            <button type="button" onclick="changeMonth(1)" class="p-2 text-gray-600 hover:bg-gray-100 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>

                        <div class="grid grid-cols-7 gap-1 text-center text-xs font-medium text-gray-500 mb-2">
                            <div class="text-red-500">æ—¥</div>
                            <div>æœˆ</div>
                            <div>ç«</div>
                            <div>æ°´</div>
                            <div>æœ¨</div>
                            <div>é‡‘</div>
                            <div class="text-blue-500">åœŸ</div>
                        </div>

                        <div id="calendar-grid" class="grid grid-cols-7 gap-1">
                            <!-- JSã§ç”Ÿæˆ -->
                        </div>
                    </div>
                    <input type="hidden" name="date" id="date-input">
                </div>

                <!-- STEP 4: æ™‚é–“é¸æŠ -->
                <div id="step-4" class="step-section hidden fade-in">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">4</span>
                        æ™‚é–“ã‚’é¸æŠ
                    </h2>
                    <div id="time-slots-container" class="grid grid-cols-3 gap-3">
                        <!-- JSã§ç”Ÿæˆ -->
                    </div>
                    <input type="hidden" name="time" id="time-input">
                </div>

                <!-- STEP 5: ãŠå®¢æ§˜æƒ…å ± -->
                <div id="step-5" class="step-section hidden fade-in">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">5</span>
                        ãŠå®¢æ§˜æƒ…å ±
                    </h2>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ãŠåå‰ <span class="text-red-500 text-xs">å¿…é ˆ</span></label>
                            <input type="text" name="name" id="name" placeholder="å±±ç”° èŠ±å­" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none transition-all" required oninput="validateStep5()">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ç”Ÿå¹´æœˆæ—¥ï¼ˆ8æ¡ï¼‰ <span class="text-red-500 text-xs">å¿…é ˆ</span></label>
                            <input type="tel" name="birthdate" id="birthdate" placeholder="20040101" maxlength="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none transition-all" required oninput="validateStep5()">
                            <p class="text-xs text-gray-500 mt-1">â€»åŠè§’æ•°å­—8æ¡ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 20040101ï¼‰</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">é›»è©±ç•ªå· <span class="text-red-500 text-xs">å¿…é ˆ</span></label>
                            <input type="tel" name="phone" id="phone" placeholder="09012345678" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none transition-all" required oninput="validateStep5()">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                            <input type="email" name="email" id="email" placeholder="example@gmail.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none transition-all">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å‚™è€ƒæ¬„</label>
                            <textarea name="remarks" id="remarks" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none transition-all" placeholder="ã”è³ªå•ã‚„ã”è¦æœ›ãŒã‚ã‚Œã°ã”è¨˜å…¥ãã ã•ã„"></textarea>
                        </div>

                        <div class="pt-2">
                            <label class="flex items-start cursor-pointer">
                                <div class="relative flex items-center">
                                    <input type="checkbox" id="privacy-check" class="w-5 h-5 text-pink-600 border-gray-300 rounded focus:ring-pink-500" onchange="validateStep5()">
                                </div>
                                <div class="ml-3 text-sm">
                                    <a href="#" class="text-pink-600 underline hover:text-pink-800">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>ã«åŒæ„ã™ã‚‹ <span class="text-red-500 text-xs">å¿…é ˆ</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- STEP 6: ç‰¹å…¸é¸æŠ (æ¡ä»¶ä»˜ã) -->
                <div id="step-6" class="step-section hidden fade-in">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">6</span>
                        ã”æ¥åº—ç‰¹å…¸
                    </h2>
                    <p class="text-sm text-gray-600 mb-4 bg-pink-50 p-3 rounded-lg border border-pink-100">
                        æŒ¯è¢–ã‚’ã”äºˆç´„ã®ãŠå®¢æ§˜é™å®šï¼<br>
                        ã„ãšã‚Œã‹1ã¤ãŠé¸ã³ã„ãŸã ã‘ã¾ã™ã€‚
                    </p>

                    <div class="space-y-3">
                        <label class="cursor-pointer block relative">
                            <input type="radio" name="gift" value="ã‚«ã‚¿ãƒ­ã‚°ã‚®ãƒ•ãƒˆ" class="custom-radio sr-only" onchange="handleGiftChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <div>
                                    <div class="font-bold">ã‚«ã‚¿ãƒ­ã‚°ã‚®ãƒ•ãƒˆ</div>
                                    <div class="text-xs text-gray-500">äººæ°—ãƒ–ãƒ©ãƒ³ãƒ‰ã‚³ã‚¹ãƒ¡å¤šæ•°æ²è¼‰ï¼</div>
                                </div>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="gift" value="CLIO ã‚¢ã‚¤ã‚·ãƒ£ãƒ‰ã‚¦ãƒ‘ãƒ¬ãƒƒãƒˆ" class="custom-radio sr-only" onchange="handleGiftChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <div>
                                    <div class="font-bold">CLIO ã‚¢ã‚¤ã‚·ãƒ£ãƒ‰ã‚¦ãƒ‘ãƒ¬ãƒƒãƒˆ</div>
                                </div>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="gift" value="CHANEL ãƒªãƒƒãƒ—" class="custom-radio sr-only" onchange="handleGiftChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <div>
                                    <div class="font-bold">CHANEL ãƒªãƒƒãƒ—</div>
                                </div>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="gift" value="Amazonã‚®ãƒ•ãƒˆåˆ¸ 2000å††åˆ†" class="custom-radio sr-only" onchange="handleGiftChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <div>
                                    <div class="font-bold">Amazonã‚®ãƒ•ãƒˆåˆ¸ 2,000å††åˆ†</div>
                                </div>
                            </div>
                        </label>

                        <label class="cursor-pointer block relative">
                            <input type="radio" name="gift" value="æ˜ ç”»é‘‘è³ãƒšã‚¢ãƒã‚±ãƒƒãƒˆ" class="custom-radio sr-only" onchange="handleGiftChange(this)">
                            <div class="p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-pink-300 transition-all flex items-center">
                                <span class="w-5 h-5 rounded-full border border-gray-300 mr-3 flex-shrink-0 flex items-center justify-center">
                                    <div class="check-icon w-2.5 h-2.5 bg-pink-500 rounded-full opacity-0 transition-opacity"></div>
                                </span>
                                <div>
                                    <div class="font-bold">æ˜ ç”»é‘‘è³ãƒšã‚¢ãƒã‚±ãƒƒãƒˆ</div>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- STEP 7: ç¢ºèª -->
                <div id="step-7" class="step-section hidden fade-in">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">âœ“</span>
                        å…¥åŠ›å†…å®¹ã®ç¢ºèª
                    </h2>

                    <div class="bg-gray-50 rounded-xl p-4 space-y-4 text-sm border border-gray-200">
                        <div class="border-b border-gray-200 pb-2">
                            <div class="text-gray-500 text-xs mb-1">ã”äºˆç´„å†…å®¹</div>
                            <div class="font-bold text-gray-800 text-base" id="confirm-menu"></div>
                        </div>

                        <div class="border-b border-gray-200 pb-2">
                            <div class="text-gray-500 text-xs mb-1">åº—èˆ—</div>
                            <div class="font-bold text-gray-800 text-base" id="confirm-store"></div>
                        </div>

                        <div class="flex gap-4 border-b border-gray-200 pb-2">
                            <div class="flex-1">
                                <div class="text-gray-500 text-xs mb-1">æ¥åº—æ—¥</div>
                                <div class="font-bold text-gray-800 text-base" id="confirm-date"></div>
                            </div>
                            <div class="flex-1">
                                <div class="text-gray-500 text-xs mb-1">æ¥åº—æ™‚é–“</div>
                                <div class="font-bold text-gray-800 text-base" id="confirm-time"></div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-2">
                            <div class="text-gray-500 text-xs mb-1">ãŠåå‰</div>
                            <div class="font-bold text-gray-800" id="confirm-name"></div>
                        </div>

                        <div class="border-b border-gray-200 pb-2">
                            <div class="text-gray-500 text-xs mb-1">ç”Ÿå¹´æœˆæ—¥</div>
                            <div class="font-bold text-gray-800" id="confirm-birthdate"></div>
                        </div>

                        <div class="border-b border-gray-200 pb-2">
                            <div class="text-gray-500 text-xs mb-1">é›»è©±ç•ªå·</div>
                            <div class="font-bold text-gray-800" id="confirm-phone"></div>
                        </div>

                        <div id="confirm-gift-container" class="border-b border-gray-200 pb-2 hidden">
                            <div class="text-gray-500 text-xs mb-1">ã”æ¥åº—ç‰¹å…¸</div>
                            <div class="font-bold text-pink-600" id="confirm-gift"></div>
                        </div>

                        <div>
                            <div class="text-gray-500 text-xs mb-1">å‚™è€ƒ</div>
                            <div class="text-gray-800" id="confirm-remarks"></div>
                        </div>
                    </div>
                </div>

                <!-- STEP Complete: å®Œäº†ç”»é¢ -->
                <div id="step-complete" class="hidden fade-in text-center py-10">
                    <div class="mb-6 text-green-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 mx-auto" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold mb-2 text-gray-800">äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼</h3>
                    <p class="text-gray-600 mb-6">ã”äºˆç´„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>å½“æ—¥ãŠä¼šã„ã§ãã‚‹ã®ã‚’æ¥½ã—ã¿ã«ã—ã¦ãŠã‚Šã¾ã™ã€‚</p>

                    <div id="complete-message" class="hidden mb-6 p-4 rounded bg-gray-100 text-sm"></div>

                    <button type="button" onclick="liff.closeWindow()" class="bg-gray-800 text-white font-bold py-3 px-8 rounded-full shadow hover:bg-gray-700 transition-colors">
                        LINEã«æˆ»ã‚‹
                    </button>
                </div>

            </form>
        </main>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼‰ -->
        <footer class="bg-white border-t border-gray-200 p-4 sticky bottom-0 z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]" id="footer-nav">
            <div class="flex gap-3 max-w-md mx-auto">
                <button type="button" id="back-btn" class="flex-1 py-3 px-4 rounded-xl font-bold text-gray-500 bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-30 hidden" onclick="goBack()">
                    æˆ»ã‚‹
                </button>
                <button type="button" id="next-btn" class="flex-[2] py-3 px-4 rounded-xl font-bold text-white bg-pink-500 shadow-md hover:bg-pink-600 transition-all disabled:opacity-50 disabled:shadow-none transform active:scale-95" onclick="goNext()" disabled>
                    æ¬¡ã¸é€²ã‚€
                </button>
                <button type="button" id="submit-btn" class="flex-[2] py-3 px-4 rounded-xl font-bold text-white bg-pink-600 shadow-lg hover:bg-pink-700 transition-all hidden transform active:scale-95 flex items-center justify-center gap-2" onclick="submitForm()">
                    <span>äºˆç´„ã‚’ç¢ºå®šã™ã‚‹</span>
                </button>
            </div>
        </footer>
    </div>

    <script>
        // ==========================================
        //  è¨­å®šã‚¨ãƒªã‚¢ï¼ˆã“ã“ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼‰
        // ==========================================

        // ã€é‡è¦ã€‘GASã‚’ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€ã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸURLã‚’ã“ã“ã«è²¼ã£ã¦ãã ã•ã„
        // ä¾‹: "https://script.google.com/macros/s/xxxxxxxxxxxxxxxxx/exec"
        const API_ENDPOINT = "YOUR_GAS_WEB_APP_URL";

        // ã€é‡è¦ã€‘LINE Developersã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å–å¾—ã—ãŸLIFF IDã‚’ã“ã“ã«è¨­å®šã—ã¦ãã ã•ã„
        const LIFF_ID = "2006508190-m0e4XMnQ"; // é–‹ç™ºç”¨ãƒ€ãƒŸãƒ¼IDãŒå…¥ã£ã¦ã„ã¾ã™

        // ==========================================
        //  ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒªã‚¢
        // ==========================================

        let currentStep = 1;
        // ç‰¹å…¸ã‚¹ã‚­ãƒƒãƒ—ã®ãƒ•ãƒ©ã‚°
        let skipGiftStep = false;
        // æœ€çµ‚ã‚¹ãƒ†ãƒƒãƒ—ç•ªå·ï¼ˆå‹•çš„ã«å¤‰åŒ–ï¼‰
        let totalSteps = 6;

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        const formData = {
            lineUserId: '',
            displayName: '',
            menu: '',
            store: '',
            date: '',
            time: '',
            name: '',
            birthdate: '',
            phone: '',
            email: '',
            remarks: '',
            gift: ''
        };

        // åº—èˆ—ãƒ‡ãƒ¼ã‚¿ï¼ˆå–¶æ¥­æ™‚é–“ãªã©ï¼‰
        const storeData = {
            "ã‹ã›å±‹ å’Œæ­Œå±±åº—": {
                start: 10,
                end: 19
            },
            "ã‹ã›å±‹ æµ·å—åº—": {
                start: 10,
                end: 18
            },
            "ã‹ã›å±‹ å²©å‡ºåº—": {
                start: 10,
                end: 18.5
            } // 18:30
        };

        // DOMè¦ç´ 
        const progressBar = document.getElementById('progress-bar');
        const progressPercent = document.getElementById('progress-percent');
        const stepStatus = document.getElementById('step-status');
        const backButton = document.getElementById('back-btn');
        const nextButton = document.getElementById('next-btn');
        const submitButton = document.getElementById('submit-btn');
        const sections = {};

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦ç´ ã®å–å¾—
            for (let i = 1; i <= 7; i++) sections[i] = document.getElementById(`step-${i}`);
            sections['complete'] = document.getElementById('step-complete');
            sections['E-redirect'] = document.getElementById('step-E-redirect');

            // UIåˆæœŸåŒ–
            initCalendar();
            updateStepNavUI();

            // LIFFåˆæœŸåŒ–
            initLiff();
        });

        // LIFFåˆæœŸåŒ–å‡¦ç†
        async function initLiff() {
            try {
                // LIFF IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé–‹ç™ºç”¨ï¼‰
                if (!LIFF_ID || LIFF_ID === "2006508190-m0e4XMnQ") {
                    console.log("LIFF IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ã€LIFFåˆæœŸåŒ–ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚");
                    return;
                }

                await liff.init({
                    liffId: LIFF_ID
                });

                if (liff.isLoggedIn()) {
                    const profile = await liff.getProfile();
                    formData.lineUserId = profile.userId;
                    formData.displayName = profile.displayName;
                    console.log("LINEãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸ:", formData.displayName);
                } else {
                    // ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆã€å¿…è¦ã«å¿œã˜ã¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä¿ƒã™å‡¦ç†ã‚’å…¥ã‚Œã‚‹
                    // liff.login(); 
                    console.log("LINEã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ï¼ˆã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦æ‰±ã„ã¾ã™ï¼‰");
                }
            } catch (err) {
                console.error("LIFF Initialization failed", err);
                // ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚ãƒ•ã‚©ãƒ¼ãƒ è‡ªä½“ã¯å‹•ãã‚ˆã†ã«ã™ã‚‹
            }
        }

        // ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³UIæ›´æ–°
        function updateStepNavUI() {
            // é€²æ—ãƒãƒ¼æ›´æ–°
            let percent;
            if (currentStep === 1) percent = 15;
            else if (currentStep > totalSteps) percent = 100; // å®Œäº†
            else percent = Math.min(100, Math.round(((currentStep - 1) / totalSteps) * 100) + 10);

            progressBar.style.width = `${percent}%`;
            progressPercent.textContent = `${percent}%`;
            stepStatus.textContent = `Step ${currentStep > totalSteps ? totalSteps : currentStep}/${totalSteps}`;

            // ã‚¹ãƒ†ãƒƒãƒ—ãƒ‰ãƒƒãƒˆæ›´æ–° (ç°¡æ˜“å®Ÿè£…)
            const dotsContainer = document.getElementById('step-dots-container');
            dotsContainer.innerHTML = '';
            // è¡¨ç¤ºç”¨ã®ã‚¹ãƒ†ãƒƒãƒ—æ•°ã§ãƒ‰ãƒƒãƒˆç”Ÿæˆ
            const displaySteps = skipGiftStep ? 6 : 7; // ç‰¹å…¸ã‚¹ã‚­ãƒƒãƒ—ãªã‚‰å…¨6ã‚¹ãƒ†ãƒƒãƒ—(ç¢ºèªç”»é¢å«ã‚€)

            for (let i = 0; i < displaySteps; i++) {
                const dot = document.createElement('div');
                dot.className = `h-1.5 flex-1 mx-0.5 rounded-full step-dot ${i < (currentStep -1) ? 'completed' : ''} ${i === (currentStep -1) ? 'active' : 'bg-gray-200'}`;
                // activeä»¥å¤–ã®è‰²ã¯CSSã§èª¿æ•´
                if (i < (currentStep - 1)) dot.classList.add('bg-pink-400');
                dotsContainer.appendChild(dot);
            }

            // ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ¶å¾¡
            if (currentStep === 1) {
                backButton.classList.add('hidden');
            } else {
                backButton.classList.remove('hidden');
            }

            if (currentStep === totalSteps + 1) { // ç¢ºèªç”»é¢ (å†…éƒ¨ãƒ­ã‚¸ãƒƒã‚¯çš„ã«ã¯ totalSteps + 1 ãŒç¢ºèªç”»é¢)
                nextButton.classList.add('hidden');
                submitButton.classList.remove('hidden');
                stepStatus.textContent = "ç¢ºèª";
            } else {
                nextButton.classList.remove('hidden');
                submitButton.classList.add('hidden');

                // æ¬¡ã¸ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ¤å®š
                validateCurrentStep();
            }
        }

        // æ¬¡ã¸é€²ã‚€
        function goNext() {
            // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã®è¦ç´ ã‚’éè¡¨ç¤º
            if (sections[currentStep]) sections[currentStep].classList.add('hidden');

            // ã‚¹ãƒ†ãƒƒãƒ—åŠ ç®—ãƒ­ã‚¸ãƒƒã‚¯
            let nextStep = currentStep + 1;

            // ç‰¹å…¸ã‚¹ã‚­ãƒƒãƒ—åˆ¤å®š (Step 5 -> Step 7)
            if (currentStep === 5 && skipGiftStep) {
                nextStep = 7;
            }

            currentStep = nextStep;

            // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡¨ç¤º
            if (sections[currentStep]) sections[currentStep].classList.remove('hidden');

            // ç¢ºèªç”»é¢(Step 7)ãªã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
            if (currentStep === 7) {
                renderConfirmData();
            }

            // ç”»é¢ãƒˆãƒƒãƒ—ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('main-content').scrollTop = 0;

            updateStepNavUI();
        }

        // æˆ»ã‚‹
        function goBack() {
            // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’éè¡¨ç¤º
            if (sections[currentStep]) sections[currentStep].classList.add('hidden');

            let prevStep = currentStep - 1;

            // ç‰¹å…¸ã‚¹ã‚­ãƒƒãƒ—åˆ¤å®š (Step 7 -> Step 5)
            if (currentStep === 7 && skipGiftStep) {
                prevStep = 5;
            }

            currentStep = prevStep;

            // å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡¨ç¤º
            if (sections[currentStep]) sections[currentStep].classList.remove('hidden');

            updateStepNavUI();
        }

        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ¬¡ã¸ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡ï¼‰
        function validateCurrentStep() {
            let isValid = false;

            switch (currentStep) {
                case 1: // ãƒ¡ãƒ‹ãƒ¥ãƒ¼
                    isValid = !!formData.menu;
                    break;
                case 2: // åº—èˆ—
                    isValid = !!formData.store;
                    break;
                case 3: // æ—¥ä»˜
                    isValid = !!formData.date;
                    break;
                case 4: // æ™‚é–“
                    isValid = !!formData.time;
                    break;
                case 5: // å€‹äººæƒ…å ±
                    // ç°¡æ˜“ãƒã‚§ãƒƒã‚¯
                    isValid = formData.name &&
                        formData.birthdate && /^\d{8}$/.test(formData.birthdate) &&
                        formData.phone &&
                        document.getElementById('privacy-check').checked;
                    break;
                case 6: // ç‰¹å…¸
                    isValid = !!formData.gift;
                    break;
            }

            nextButton.disabled = !isValid;
        }

        // ---------------
        // å„ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒãƒ³ãƒ‰ãƒ©
        // ---------------

        // Step 1: ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ
        function handleMenuChange(radio) {
            formData.menu = radio.value;

            // åˆ†å²ãƒ­ã‚¸ãƒƒã‚¯
            if (radio.value.includes('æŒ¯è¢–ï¼ˆã”è³¼å…¥ï¼‰') || radio.value.includes('æŒ¯è¢–ï¼ˆãƒ¬ãƒ³ã‚¿ãƒ«ï¼‰')) {
                // ç‰¹å…¸ã‚ã‚Š
                skipGiftStep = false;
                totalSteps = 6; // ç¢ºèªç”»é¢(7)ã®å‰ã¾ã§ãŒ6ã‚¹ãƒ†ãƒƒãƒ—
            } else if (radio.value.includes('E-redirect')) {
                // HTMLä¸Šã§ã¯Eã¯åˆ¥IDæ‰±ã„ã ãŒã€valueã§åˆ¤å®šã™ã‚‹å ´åˆ
            } else if (radio.value.includes('å’æ¥­è¢´ï¼ˆä¸€å¼ãƒ¬ãƒ³ã‚¿ãƒ«')) {
                // Eãƒ‘ã‚¿ãƒ¼ãƒ³: é›»è©±èª˜å°ã¸
                sections[1].classList.add('hidden');
                document.getElementById('footer-nav').classList.add('hidden'); // ãƒ•ãƒƒã‚¿ãƒ¼æ¶ˆã™
                sections['E-redirect'].classList.remove('hidden');
                return;
            } else {
                // ç‰¹å…¸ãªã—ï¼ˆãƒãƒæŒ¯è¢–ã€å’æ¥­è¢´ã®ã¿ç­‰ï¼‰
                skipGiftStep = true;
                totalSteps = 5; // ç‰¹å…¸(6)ã‚’é£›ã°ã™ã®ã§å®Ÿè³ªã‚¹ãƒ†ãƒƒãƒ—æ•°ã¯æ¸›ã‚‹ãŒã€IDç®¡ç†ä¸Šã¯å°‘ã—ã‚„ã‚„ã“ã—ã„ã®ã§ã€Œç¢ºèªç”»é¢ã€ã‚’æœ€çµ‚ã¨ã™ã‚‹
            }

            validateCurrentStep();
        }

        // Eãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒªã‚»ãƒƒãƒˆ
        function resetForm() {
            location.reload();
        }

        // Step 2: åº—èˆ—é¸æŠ
        function handleStoreChange(radio) {
            formData.store = radio.value;
            // åº—èˆ—ãŒå¤‰ã‚ã£ãŸã‚‰æ™‚é–“é¸æŠã‚‚ãƒªã‚»ãƒƒãƒˆã™ã¹ãã ãŒã€ä»Šå›ã¯ç°¡æ˜“çš„ã«
            validateCurrentStep();

            // Step 4ã®æ™‚é–“æ å†ç”Ÿæˆã®ãŸã‚ã«å¿…è¦ãªã‚‰ã“ã“ã§ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
            generateTimeSlots(); // å†ç”Ÿæˆ
        }

        // Step 3: æ—¥ä»˜é¸æŠ (ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼)
        let currentDate = new Date();
        let currentYear = currentDate.getFullYear();
        let currentMonth = currentDate.getMonth();

        function initCalendar() {
            renderCalendar(currentYear, currentMonth);
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar(currentYear, currentMonth);
        }

        function renderCalendar(year, month) {
            const calendarGrid = document.getElementById('calendar-grid');
            const calendarTitle = document.getElementById('calendar-title');
            calendarGrid.innerHTML = '';
            calendarTitle.textContent = `${year}å¹´ ${month + 1}æœˆ`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // ç©ºç™½ã‚»ãƒ«
            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }

            // æ—¥ä»˜ã‚»ãƒ«
            for (let d = 1; d <= daysInMonth; d++) {
                const dateObj = new Date(year, month, d);
                const isPast = dateObj < today;

                // 3ãƒ¶æœˆå…ˆã¾ã§è¨±å¯ãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ãªã‚‰ã“ã“
                const maxDate = new Date();
                maxDate.setMonth(maxDate.getMonth() + 3);
                const isTooFar = dateObj > maxDate;

                const div = document.createElement('div');
                div.className = `calendar-day ${isPast || isTooFar ? 'disabled' : ''}`;
                div.textContent = d;

                if (dateObj.getTime() === today.getTime()) {
                    div.classList.add('today');
                }

                // é¸æŠçŠ¶æ…‹ã®å¾©å…ƒ
                const selectedDateStr = formData.date; // "YYYY-MM-DD"
                const currentStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;

                if (selectedDateStr === currentStr) {
                    div.classList.add('selected');
                }

                if (!isPast && !isTooFar) {
                    div.onclick = () => {
                        // é¸æŠè§£é™¤
                        document.querySelectorAll('.calendar-day').forEach(el => el.classList.remove('selected'));
                        div.classList.add('selected');
                        formData.date = currentStr;
                        document.getElementById('date-input').value = currentStr;
                        validateCurrentStep();

                        // æ™‚é–“æ ã®ç©ºãçŠ¶æ³ãƒªã‚»ãƒƒãƒˆï¼ˆæœ¬æ¥ã¯ã‚µãƒ¼ãƒãƒ¼å•ã„åˆã‚ã›ï¼‰
                        generateTimeSlots();
                    };
                }

                calendarGrid.appendChild(div);
            }
        }

        // Step 4: æ™‚é–“é¸æŠ
        function generateTimeSlots() {
            const container = document.getElementById('time-slots-container');
            container.innerHTML = '';

            if (!formData.store) return; // åº—èˆ—æœªé¸æŠãªã‚‰ç”Ÿæˆã—ãªã„

            const hours = storeData[formData.store];
            const startHour = hours.start;
            const endHour = hours.end;

            // 30åˆ†åˆ»ã¿ã§ç”Ÿæˆ
            for (let h = startHour; h < endHour; h++) {
                for (let m of [0, 30]) {
                    // é–‰åº—æ™‚é–“ã‚’è¶…ãˆã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆä¾‹: 18:30é–‰åº—ã§18:30é–‹å§‹ã®æ ã¯ä½œã‚‰ãªã„å ´åˆï¼‰
                    if (h === Math.floor(endHour) && m >= (endHour % 1) * 60 && (endHour % 1) > 0) continue;
                    if (h >= endHour) continue;

                    const timeStr = `${h}:${m === 0 ? '00' : '30'}`;
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'time-slot border border-gray-300 rounded-lg p-2 text-sm font-medium bg-white w-full';
                    btn.textContent = timeStr;

                    // ãƒ‡ãƒ¢ç”¨: ãƒ©ãƒ³ãƒ€ãƒ ã§æº€å¸­ã«ã™ã‚‹ (APIãŒãªã„ãŸã‚)
                    // æœ¬ç•ªã§ã¯ã“ã“ã§APIã‹ã‚‰å–å¾—ã—ãŸç©ºãçŠ¶æ³ã‚’å‚ç…§ã™ã‚‹
                    const isFull = Math.random() < 0.15;

                    if (isFull) {
                        btn.disabled = true;
                        btn.classList.add('bg-gray-100', 'text-gray-400', 'cursor-not-allowed');
                        btn.textContent += ' (æº€)';
                    } else {
                        btn.onclick = () => {
                            document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected'));
                            btn.classList.add('selected');
                            formData.time = timeStr;
                            validateCurrentStep();
                        };
                    }

                    // é¸æŠå¾©å…ƒ
                    if (formData.time === timeStr) {
                        btn.classList.add('selected');
                    }

                    container.appendChild(btn);
                }
            }
        }

        // Step 5: å…¥åŠ›ç›£è¦–
        function validateStep5() {
            formData.name = document.getElementById('name').value;
            formData.birthdate = document.getElementById('birthdate').value;
            formData.phone = document.getElementById('phone').value;
            formData.email = document.getElementById('email').value;
            formData.remarks = document.getElementById('remarks').value;

            validateCurrentStep();
        }

        // Step 6: ç‰¹å…¸é¸æŠ
        function handleGiftChange(radio) {
            formData.gift = radio.value;
            validateCurrentStep();
        }

        // Step 7: ç¢ºèªè¡¨ç¤º
        function renderConfirmData() {
            document.getElementById('confirm-menu').textContent = formData.menu;
            document.getElementById('confirm-store').textContent = formData.store;
            document.getElementById('confirm-date').textContent = formData.date;
            document.getElementById('confirm-time').textContent = formData.time;
            document.getElementById('confirm-name').textContent = formData.name;
            document.getElementById('confirm-birthdate').textContent = formData.birthdate;
            document.getElementById('confirm-phone').textContent = formData.phone;
            document.getElementById('confirm-remarks').textContent = formData.remarks || '(ãªã—)';

            const giftContainer = document.getElementById('confirm-gift-container');
            if (skipGiftStep) {
                giftContainer.classList.add('hidden');
                formData.gift = ''; // ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
            } else {
                giftContainer.classList.remove('hidden');
                document.getElementById('confirm-gift').textContent = formData.gift;
            }
        }

        // é€ä¿¡å‡¦ç† (è‡ªç¤¾ã‚µãƒ¼ãƒãƒ¼ç”¨ fetchç‰ˆ)
        async function submitForm() {
            if (API_ENDPOINT === "https://script.google.com/macros/s/AKfycbys4zBQKGoHgMXXORNuzwZrKcQnSLhoNBwBND05DEYoc6XEG45qPz0JKoXfrFeULZKP/exec") {
                showMessage("ã‚¨ãƒ©ãƒ¼: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«ã”é€£çµ¡ãã ã•ã„ã€‚", "error");
                return;
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            const btnText = submitButton.querySelector('span');
            const originalText = btnText.textContent;
            btnText.textContent = 'é€ä¿¡ä¸­...';
            submitButton.disabled = true;
            submitButton.innerHTML = '<div class="loader mr-2"></div> é€ä¿¡ä¸­...';

            try {
                // Fetch APIã§GASã¸é€ä¿¡
                // note: GASã®Webã‚¢ãƒ—ãƒªã¯JSON POSTã‚’å—ã‘å–ã‚‹éš›ã€CORSè¨­å®šã‚„redirectå‡¦ç†ã«æ³¨æ„ãŒå¿…è¦
                // æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªã®ã¯ã€text/plainã§æŠ•ã’ã¦GASå´ã§JSON.parseã™ã‚‹æ–¹æ³•

                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    mode: 'cors', // CORSãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                        // GASã¯application/jsonã ã¨preflightã§å¤±æ•—ã™ã‚‹å ´åˆãŒã‚ã‚‹ãŸã‚text/plainæ¨å¥¨
                    },
                    body: JSON.stringify(formData)
                });

                // GASã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
                const result = await response.json();

                if (result.status === 'success') {
                    handleSuccess(result);
                } else {
                    throw new Error(result.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
                }

            } catch (error) {
                console.error("é€ä¿¡ã‚¨ãƒ©ãƒ¼:", error);
                showMessage(`äºˆç´„å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`, "error");

                // ãƒœã‚¿ãƒ³å¾©å¸°
                submitButton.disabled = false;
                submitButton.textContent = originalText;
                submitButton.innerHTML = '<span>äºˆç´„ã‚’ç¢ºå®šã™ã‚‹</span>'; // ã‚¢ã‚¤ã‚³ãƒ³æˆ»ã™ã®ã¯çœç•¥
            }
        }

        function handleSuccess(data) {
            // å®Œäº†ç”»é¢ã¸
            document.getElementById('footer-nav').classList.add('hidden');
            document.getElementById('step-7').classList.add('hidden');
            document.getElementById('step-complete').classList.remove('hidden');

            // ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã¸
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });

            if (data.reservationId) {
                const msgBox = document.getElementById('complete-message');
                msgBox.textContent = `äºˆç´„ç•ªå·: ${data.reservationId}`;
                msgBox.classList.remove('hidden');
            }
        }

        function showMessage(msg, type) {
            const area = document.getElementById('message-area');
            area.textContent = msg;
            area.className = `mb-4 p-3 rounded-lg text-sm text-center font-medium shadow-sm ${type === 'error' ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}`;
            area.classList.remove('hidden');
            area.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        }

    </script>
</body>

</html>
